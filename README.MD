# FIAP SRV VeÃ­culos

ServiÃ§o de gerenciamento de veÃ­culos construÃ­do em **FastAPI** com arquitetura **Hexagonal (Ports & Adapters)**, utilizando **PostgreSQL** como banco de dados e **Docker Compose** para orquestraÃ§Ã£o dos serviÃ§os.

---

## ğŸ—ï¸ Arquitetura

A aplicaÃ§Ã£o segue os princÃ­pios de **Domain-Driven Design (DDD)** e **Hexagonal Architecture**:

- **Domain (`src/domain`)**  
  ContÃ©m as entidades centrais (`Vehicle`, `VehicleStatus`) e regras de negÃ³cio.

- **Application (`src/application`)**  
  Define os casos de uso (`create_vehicle`, `reserve_vehicle`, `sell_vehicle`, `unreserve_vehicle`).

- **Ports (`src/ports`)**  
  Protocolos/interfaces que definem contratos de repositÃ³rios.

- **Adapters (`src/adapters`)**  
  - **DB (`src/adapters/db`)**: implementaÃ§Ã£o usando SQLAlchemy.  
  - **HTTP (`src/adapters/http`)**: exposiÃ§Ã£o dos endpoints via FastAPI.

- **Infraestrutura**  
  Banco de dados PostgreSQL rodando em container Docker.

---

## ğŸ—„ï¸ Banco de Dados

- Banco escolhido: **PostgreSQL**
- Motivos:
  - Robustez e confiabilidade
  - Bom suporte a tipos enumerados (enums), usado para `VehicleStatus`
  - IntegraÃ§Ã£o nativa com SQLAlchemy
- MigraÃ§Ãµes gerenciadas com **Alembic**

---

## ğŸš€ Como rodar o projeto

### 1. Subir containers

```bash
sudo docker compose up --build -d
```

### 2. Aplicar migraÃ§Ãµes

```bash
alembic upgrade head
```

### 3. Acessar API

A aplicaÃ§Ã£o roda em:  
ğŸ‘‰ [http://localhost:8001](http://localhost:8001)

---

## ğŸ“š Endpoints

### Health

- `GET /healthz` â†’ Verifica se a API estÃ¡ viva  
- `GET /readyz` â†’ Verifica conectividade com o banco

---

### Vehicles

- **Criar veÃ­culo**

```http
POST /vehicles
Content-Type: application/json

{
  "brand": "Ford",
  "model": "Fiesta",
  "year": 2018,
  "color": "blue",
  "price": 45000.0
}
```

- **Listar veÃ­culos por status**

```http
GET /vehicles?status=available
GET /vehicles?status=reserved
GET /vehicles?status=sold
```

- **Reservar veÃ­culo**

```http
POST /vehicles/{id}/reserve
Content-Type: application/json

{
  "reserved_by": "kaneda"
}
```

- **Cancelar reserva**

```http
POST /vehicles/{id}/unreserve
Content-Type: application/json

{
  "reserved_by": "kaneda"
}
```

- **Marcar como vendido**

```http
POST /vehicles/{id}/sell
```

---

## ğŸ§ª Testes rÃ¡pidos (curl)

```bash
# SaÃºde
curl -s http://localhost:8001/healthz
curl -s http://localhost:8001/readyz

# Listar disponÃ­veis
curl -s "http://localhost:8001/vehicles?status=available"

# Criar
curl -s -X POST http://localhost:8001/vehicles   -H "Content-Type: application/json"   -d '{"brand":"Ford","model":"Fiesta","year":2018,"color":"blue","price":45000.0}'

# Reservar
curl -s -X POST http://localhost:8001/vehicles/{id}/reserve   -H "Content-Type: application/json"   -d '{"reserved_by":"kaneda"}'

# Cancelar reserva
curl -s -X POST http://localhost:8001/vehicles/{id}/unreserve

# Vender
curl -s -X POST http://localhost:8001/vehicles/{id}/sell
```

---

## ğŸ“‚ Estrutura de Pastas

```
src/
 â”œâ”€â”€ adapters/
 â”‚   â”œâ”€â”€ db/         # ORM, repositorios, base SQLAlchemy
 â”‚   â””â”€â”€ http/       # Endpoints FastAPI
 â”‚   â””â”€â”€ messaging/  # ServiÃ§os de mensageria
 â”œâ”€â”€ application/    # Casos de uso (usecases)
 â”‚   â””â”€â”€ usecases/   # Casos de uso (usecases)
 â”œâ”€â”€ domain/         # Entidades e enums centrais
 â”œâ”€â”€ ports/          # Interfaces de repositÃ³rio
 â””â”€â”€ main.py         # Ponto de entrada da API
```

---

## ğŸ”‘ DecisÃµes de Design

1. **Arquitetura hexagonal** para garantir isolamento entre camadas e facilidade de testes.  
2. **PostgreSQL** escolhido pela robustez, compatibilidade com enums e uso em produÃ§Ã£o real.  
3. **FastAPI** para endpoints REST, validaÃ§Ã£o automÃ¡tica com Pydantic e documentaÃ§Ã£o embutida (`/docs`).  
4. **Docker Compose** para subir todo o stack com um Ãºnico comando.  
